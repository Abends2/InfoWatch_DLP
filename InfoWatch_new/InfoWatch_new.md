### 1. Установка DLP - системы InfoWatch Traffic Monitor

Для корректной работы DLP – системы InfoWatch Traffic Monitor необходимо подготовить машины со следующими операционными системами:
- Windows Server 2019, в данном курсовом проекте используется подготовленный сервер, с установленным доменом;
- Red OS 7.3.2 для установки Traffic Monitor;
- Windows 10 pro для установки Device Monitor;
- Windows 10 pro, которая будет использоваться непосредственно человеком на машине компании.

Для начала работы необходимо запустить машину с установленной операционной системой Red OS 7.3.2. После запуска нужно открыть терминал, войти в суперпользователя (root) и запустить службу SSH:

![ScreenShot](screenshots/1.png)

Следующим шагом необходимо перейти в параметры сетевых соединений:

![ScreenShot](screenshots/2.png)

После открытия параметров сетевых соединений, нужно изменить имеющееся подключение. Метод изменить на «Вручную» и добавить адреса подключения, в строке «Адрес» указываем IP-адрес, который будет присвоен данной машине, маска установится автоматически (24 или 255.255.255.0), в строке «Шлюз» необходимо указать IP–адрес сервера, в «Серверы DNS» дублируем IP-адрес сервера и в поисковой домен нужно вписать домен, установленный на сервере

![ScreenShot](screenshots/3.png)

Далее, необходимо проверить изменение параметров соединения, выполнив команду «IP a» в терминале, которая выведет все подключения и их настройки.

![ScreenShot](screenshots/4.png)

Следующим шагом необходимо создать папку в домашней директории:

![ScreenShot](screenshots/5.png)

Далее нужно подключиться к данной машине через программу WinSCP, для этого в «Имя хоста» необходимо указать IP-адрес присвоенный машине, а имя пользователя и пароль.

![ScreenShot](screenshots/6.png)

После успешного подключения необходимо произвести копирование файлов, требующихся для установки Traffic Monitor в созданную папку.

![ScreenShot](screenshots/7.png)

Далее нужно распаковать архив, находящийся в директории для получения доступа к находящимся внутри файлам

![ScreenShot](screenshots/8.png)

Следующим шагом необходимо открыть распакованный архив, и кликнуть правой кнопкой мыши по свободному месту, после чего нажать «Открыть в Терминале»

![ScreenShot](screenshots/9.png)

После открытия терминала заходим в суперпользователя и начинаем установку пакетов, необходимых для PostgreSQL

![ScreenShot](screenshots/10.png)

![ScreenShot](screenshots/11.png)

Следующим шагом необходимо установить пакет boost-devel, который необходим для корректной работы пакета pgagent

![ScreenShot](screenshots/12.png)

Далее нужно установить последний пакет, для postgresql, а именно pgagent.

![ScreenShot](screenshots/13.png)

После установки всех пакетов необходимо создать директории u01 и u02 в корне файловой системы

![ScreenShot](screenshots/14.png)

Далее инициализируем установленную базу данных

![ScreenShot](screenshots/15.png)

Следующим шагом запустим postgresql-13

![ScreenShot](screenshots/16.png)

После запуска необходимо изменить строку «Enviroment=PGDATA=…» на «Enviroment=PGDATA=/u01/postgres» в файле конфигурации posgtresql-13.service, который находится по следующему пути /usr/lib/system/systemd/postgresql-13.service

![ScreenShot](screenshots/17.png)

Для применения изменённого файла конфигурации необходимо выполнить следующую команду

![ScreenShot](screenshots/18.png)

Далее показано создание директории postgres по пути /u01/ и выдача прав владельца этой директорией пользователю postgres.

![ScreenShot](screenshots/19.png)

Далее показана инициализация базы данных

![ScreenShot](screenshots/20.png)
  
Ниже показано создание директорий tmp по пути /u01/postgres/, pgdata, pgdata1 и arch по пути /u02/ соответственно, и выдача прав владельца этих директорий пользователю postgres.

![ScreenShot](screenshots/21.png)

Следующим шагом необходимо изменить файл конфигурации iwtm-postgres, которы находится по пути /u01/postgres/iwtm-postgres.conf. В нём нужно изменить значения у следующих строк: shared\_buffers, temp\_buffers, work\_mem, effective\_cache\_size, min\_wal\_size, max\_wal\_size, maintenance\_work\_mem.

![ScreenShot](screenshots/22.png)

Выполнение команды для изменения владельца файла конфигурации iwtm-postgres.conf на пользователя postgres:

![ScreenShot](screenshots/23.png)

Далее нужно добавить в конфигурационный файл postgresql.conf ссылку на файл iwtm-postgres.conf

![ScreenShot](screenshots/24.png)

Ниже показана настройка файла доступа pg\_hba.conf.

![ScreenShot](screenshots/25.png)

Следующим шагом запустим и посмотрим статус postgresql-13.service

![ScreenShot](screenshots/26.png)

Далее показано изменение для администратора базы данных пароля по умолчанию.

![ScreenShot](screenshots/27.png)

Следующим шагом необходимо создать расширения для базы данных, требуемых для Traffic Monitor выполнив соответствующие запросы:

![ScreenShot](screenshots/28.png)

Далее показана настройка в операционной системе пользователя pgagent.

![ScreenShot](screenshots/29.png)

Далее необходимо отредактировать содержимое файла /etc/sudoers.d/pgagent:

![ScreenShot](screenshots/30.png)

Ниже продемонстрировано изменение прав, а также владельца и группы файла/etc/sudoers.d/pgagent.

![ScreenShot](screenshots/31.png)

Следующим шагом требуется запустить сервис pgagent и проверить его статус:

![ScreenShot](screenshots/32.png)

Для продолжения работы нужно добавить компьютер с Red OS в домен, для этого необходимо настроить Active Directory на Windows Server 2019

![ScreenShot](screenshots/33.png)

Следующим шагом в лесу домена нужно создать подразделения «Департамент» и «Отдел IT», в которых будут находится рабочие машины

![ScreenShot](screenshots/34.png)

![ScreenShot](screenshots/35.png)

После этого производится создание пользователя iwdm-root в подразделении «Отдел IT»

![ScreenShot](screenshots/36.png)

Далее, при создании пользователя iwdm-root необходимо поставить галочку на пункте «Срок действия пароля не ограничен»

![ScreenShot](screenshots/37.png)

Далее показано создание пользователя iwtm-root в подразделении «Отдел IT»

![ScreenShot](screenshots/38.png)

Далее, при создании пользователя iwtm-root необходимо поставить галочку на пункте «Срок действия пароля не ограничен»

![ScreenShot](screenshots/39.png)

Создаем также пользователя ldapsync

![ScreenShot](screenshots/40.png)

![ScreenShot](screenshots/41.png)

Далее показано создание пользователя user-pc в подразделении «Департамент».

![ScreenShot](screenshots/42.png)

Следующим шагом необходимо добавить пользователя iwdm-root в следующие группы: Администраторы, Администраторы домена, Компьютеры домена и Контроллеры домена

![ScreenShot](screenshots/43.png)

Далее нужно вернуться на машину с установленной Red OS и добавить ее в домен. Для этого необходимо открыть предустановленную утилиту «Ввод в домен» и выбрать «Домен Windows/Samba»

![ScreenShot](screenshots/44.png)

Следующим шагом вводим имя домена (demo.lab), имя компьютера (iwtm), а также имя и пароль администратора домена (iwdm-root)

![ScreenShot](screenshots/45.png)

![ScreenShot](screenshots/46.png)

Перед запуском установки Traffic Monitor нужно сделать файл инсталлятора исполняемым

![ScreenShot](screenshots/47.png)

Ниже показана команда для запуска инсталлятора Traffic Monitor

![ScreenShot](screenshots/48.png)

Начало установки Traffic Monitor

![ScreenShot](screenshots/49.png)

Следующим шагом необходимо выбрать тип продукта Traffic Monitor Standart

![ScreenShot](screenshots/50.png)

Далее показан выбор русского языка продукта

![ScreenShot](screenshots/51.png)

Также необходимо выбрать язык базы данных

![ScreenShot](screenshots/52.png)

В конфигурации аутентификации на сервере базы данных нужно оставить значения по умолчанию

![ScreenShot](screenshots/53.png)

Далее показан выбор типа хранилища сервера базы данных

![ScreenShot](screenshots/54.png)

При конфигурации хранилища сервера базы данных рекомендуется оставить значения по умолчанию

![ScreenShot](screenshots/55.png)

В настройки архивации ежедневных табличных пространств рекомендуется оставить все значения по умолчанию

![ScreenShot](screenshots/56.png)

При настройке удаления ежедневных табличных пространств рекомендуется оставить все значения по умолчанию

![ScreenShot](screenshots/57.png)

Конфигурация «Cosul» сервиса, а также настройка NTP-сервера «Nagios», сервис «Sphinx»:

![ScreenShot](screenshots/58.png)

![ScreenShot](screenshots/59.png)

![ScreenShot](screenshots/60.png)

Включение использования технологии технологии OCR

![ScreenShot](screenshots/61.png)

Выбор режима распознавания

![ScreenShot](screenshots/62.png)

Далее необходимо дать согласие на установку Traffic Monitor

![ScreenShot](screenshots/63.png)

После запуска установки необходимо дождаться конца установки, не выключать и не перезагружать компьютер

![ScreenShot](screenshots/64.png)

После окончания установки нужно проверить статус сервиса iwtm-consul, выполнив в терминале команду systemctl status iwtm-consul

![ScreenShot](screenshots/65.png)

Теперь необходимо перейти к настройке машины с операционной системой Windows 10 pro, на которую будет устанавливаться Device Monitor, для начала нужно выполнить команду ncpa.cpl, для открытия сетевых подключений

![ScreenShot](screenshots/66.png)

Следующим шагом нужно настроить IPv4

![ScreenShot](screenshots/67.png)

Далее необходимо подключить машину к домену, для этого нужно открыть свойства системы через «Параметры», либо через команду sysdm.cpl

![ScreenShot](screenshots/68.png)

Далее нужно нажать «OK», и в появившемся окне указать имя учетной записи и пароль администратора домена (iwdm-root)

![ScreenShot](screenshots/69.png)

![ScreenShot](screenshots/70.png)

Следующим шагом для изменения домена нужно перезагрузить компьютер и после перезагрузки войти под другим пользователем, а именно iwdm-root

![ScreenShot](screenshots/71.png)

Далее необходимо включить сетевое обнаружение

![ScreenShot](screenshots/72.png)

После включения сетевого обнаружения нужно создать папку в корне диска C и настроить общий доступ к этой папке

![ScreenShot](screenshots/73.png)

Далее необходимо произвести установку PostgreSQL 9.6

![ScreenShot](screenshots/74.png)

![ScreenShot](screenshots/75.png)

![ScreenShot](screenshots/76.png)

![ScreenShot](screenshots/77.png)

![ScreenShot](screenshots/78.png)

Далее необходимо задать параметры сервера PostgreSQL, порт 5432, нужно выбрать «Russia, Russia», в суперпользователя указать postgres и пароль к нему, а также включить контрольные суммы для страниц

![ScreenShot](screenshots/79.png)

![ScreenShot](screenshots/80.png)

![ScreenShot](screenshots/81.png)

![ScreenShot](screenshots/82.png)

![ScreenShot](screenshots/83.png)

![ScreenShot](screenshots/84.png)

![ScreenShot](screenshots/85.png)

![ScreenShot](screenshots/86.png)

![ScreenShot](screenshots/87.png)

![ScreenShot](screenshots/88.png)

![ScreenShot](screenshots/89.png)

Следующим шагом для более комплексной работы Traffic Monitor нужно установить Device Monitor:

![ScreenShot](screenshots/90.png)

![ScreenShot](screenshots/91.png)

Далее нужно указать тип устанавливаемого сервера и параметры установки Device Monitor

![ScreenShot](screenshots/92.png)

![ScreenShot](screenshots/93.png)

Далее показано определение параметров базы данных PostgreSQL, необходимо указать localhost как сервер базы данных, указать имя базы данных, имя пользователя и пароль.

![ScreenShot](screenshots/94.png)

![ScreenShot](screenshots/95.png)

Далее настройка защищенного канала, нужно оставить все значения по умолчанию и выбрать «Создать новый ключ»

![ScreenShot](screenshots/96.png)

![ScreenShot](screenshots/97.png)

Затем показана настройка учетной записи сервера, нужно выбрать «NetworkService»

![ScreenShot](screenshots/98.png)

Далее необходимо указать учетную запись администратора сервера Device Monitor

![ScreenShot](screenshots/99.png)

Далее нужно настроить соединение с Traffic Monitor, а именно указать адрес сервера Traffic Monitor и токен авторизации

![ScreenShot](screenshots/100.png)

Следующим шагом нужно начать установку Device Monitor

![ScreenShot](screenshots/101.png)

![ScreenShot](screenshots/102.png)

Далее необходимо настроить сеть на клиентской машине с установленной Windows 10 Pro. Для этого нужно перейти в настройку IPV4 и ввести значения, показанные ниже:

![ScreenShot](screenshots/103.png)

Следующим шагом требуется ввести клиентскую машину в домен demo.lab, для этого нужно открыть свойства системы через «Параметры», либо через команду sysdm.cpl, изменение имени компьютера и указание домена

![ScreenShot](screenshots/104.png)

Далее нужно нажать «OK», и в появившемся окне указать имя учетной записи и пароль контроллера домена (iwdm-root)

![ScreenShot](screenshots/105.png)

После успешного входа в домен, необходимо произвести перезагрузку системы и войти под учетной записью другого пользователя, а именно user-pc

![ScreenShot](screenshots/106.png)

Далее нужно на клиентской машине включить сетевое обнаружение

![ScreenShot](screenshots/107.png)

Следующим шагом необходимо произвести настройку Device Monitor, нужно настроить синхронизацию со службами каталогов

![ScreenShot](screenshots/108.png)

Далее в настройки синхронизации нужно добавить компьютеры и пользователей из домена demo.lab

![ScreenShot](screenshots/109.png)

![ScreenShot](screenshots/110.png)

Пример итогового окна синхронизации после настройки

![ScreenShot](screenshots/111.png)

Следующим шагом нужно создать политику «Департамент»

![ScreenShot](screenshots/112.png)

Ниже показано создание группы компьютеров, для корректной работы нужно связать группу компьютеров с политикой и добавить компьютеры в группу

![ScreenShot](screenshots/113.png)

Следующим шагом нужно создать задачу установки агентов на клиентские машины

![ScreenShot](screenshots/114.png)

Далее нужно выбрать на какие компьютеры будет распространяться задача

![ScreenShot](screenshots/115.png)

Далее нужно указать параметры настройки агентского модуля и запуска задачи

![ScreenShot](screenshots/116.png)

Статус созданной задачи

![ScreenShot](screenshots/117.png)

Далее нужно открыть мастер создания пакета установки и выбрать каталог, в который будет сохранен готовый набор инсталляционных пакетов

![ScreenShot](screenshots/118.png)

![ScreenShot](screenshots/119.png)

Следующим шагом необходимо создать объект групповой политики на Windows Server 2019. Чтобы перейти в меню управления групповой политикой нужно выполнить команду gpmc.msc. Ниже показано создание нового объекта групповой политики под названием установка агента.

![ScreenShot](screenshots/120.png)

Далее необходимо кликнуть правой кнопкой мыши и перейти в редактор управления групповыми политиками, далее пройти по пути Конфигурация компьютера → Политики → Конфигурация программ → Установка программ → Нажать правой кнопкой мыши → Создать → Пакет и указать источник установки.

![ScreenShot](screenshots/121.png)

Следующим шагом нужно открыть командную строку на Windows Server 2019 и выполнить команду gpupdate /force для обновления групповой политики

![ScreenShot](screenshots/122.png)

Далее необходимо открыть командную строку на клиентской машине и выполнить команду gpupdate /force для обновления групповой политики

![ScreenShot](screenshots/123.png)

После выполнения команды нужно перезагрузить машину, после которой будет установлен агент и в Device Monitor изменится статус поставленной задачи

![ScreenShot](screenshots/124.png)

Следующим шагом необходимо перейти к настройке Traffic Monitor, для этого в поисковой строке браузера вводим //iwtm или IP-адрес машины с установленным Traffic Monitor (192.168.10.21). После открытия нужно авторизоваться под пользователем officer, после успешной авторизации нажать «Еще» в верхней панели и кликнуть по пункту LDAP-синхронизация

![ScreenShot](screenshots/125.png)

Следующим шагом нужно перейти в панель управления доступом, нажать на «Добавить», выбрать пункт «Добавить пользователя из LDAP» и соответственно добавить нового пользователя

![ScreenShot](screenshots/126.png)

Далее нужно выбрать роли для добавленного пользователя

![ScreenShot](screenshots/127.png)

Следующим шагом нужно выбрать область видимости для добавленного пользователя

![ScreenShot](screenshots/128.png)

---
### 2 Создание политик защиты данных на агентах

В ходе выполнения задания были выбраны следующие политики защиты данных на агентах: блокировка копирования со съемного носителя и на съемный носитель паспортных данных и данных кредитных карт. Для создания политик безопасности необходимо перейти по ссылке «Политики» в верхней панели и нажать «Добавить политику», затем выбрать «Политика защиты данных на агентах»:

![ScreenShot](screenshots/129.png)

Следующим шагом нужно выбрать защищаемые данные

![ScreenShot](screenshots/130.png)

Ниже показаны выбранные защищаемые данные для политики безопасности

![ScreenShot](screenshots/131.png)

Следующим шагом нужно добавить правило копирования, направление маршрута «В оба направления», для отслеживания передачи паспортных данных как на устройство, так и с него, тип события «Съемное устройство», политика будет отслеживать исключительно передачу файлов, при которой используется съемный носитель, источники нужно оставить по умолчанию, необходимо назначить вердикт событию «Заблокировать», дабы избежать утечки паспортных данных уровень нарушения установлен «Высокий», тег события «На рассмотрении»

![ScreenShot](screenshots/132.png)

Следующим шагом нужно создать еще одну политику, которая будет отслеживать копирование данных кредитных карт с использованием съемного носителя. Необходимо выбрать защищаемые данные, объектом защиты является номер кредитной карты (16 цифр)

![ScreenShot](screenshots/133.png)

Следующим шагом нужно добавить правило копирования, направление маршрута «В оба направления», для отслеживания передачи данных кредитных карт как на устройство, так и с него, тип события «Съемное устройство», политика будет отслеживать исключительно передачу файлов, при которой используется съемный носитель, источники нужно оставить по умолчанию, необходимо назначить вердикт событию «Заблокировать», дабы избежать утечки данных кредитных карт, уровень нарушения установлен «Высокий», тег события «На рассмотрении»

![ScreenShot](screenshots/134.png)

Следующим шагом необходимо создать правило в Device Monitor для того, чтобы происходило отслеживание действий на клиентской машине

![ScreenShot](screenshots/135.png)

Далее нужно выбрать на что будет срабатывать правило, в поле «Перехватчик» необходимо выбрать «File Monitor», условие срабатывание поставить на источник копирования для отслеживания копирования на клиентскую машину и тип источника выбрать съемные устройства

![ScreenShot](screenshots/136.png)

Создание второго правила

![ScreenShot](screenshots/137.png)

Далее нужно выбрать на что будет срабатывать правило, в поле «Перехватчик» необходимо выбрать «File Monitor», условие срабатывание поставить на приемник копирования для отслеживания передачи с клиентской машины и тип источника выбрать съемные устройства

![ScreenShot](screenshots/138.png)

![ScreenShot](screenshots/139.png)

Следующим шагом необходимо применить конфигурацию в Traffic Monitor

![ScreenShot](screenshots/140.png)

---
### 3. Проверка работоспособности

После настроек политик безопасности необходимо проверить работоспособность. Первой политикой защиты данных на агентах было правило копирования паспортных данных на съемный носитель и со съемного носителя. Нарушив данную политику на машине клиента, появляется уведомление от Device Monitor

![ScreenShot](screenshots/141.png)

Далее нужно проверить отчет в Device Monitor

![ScreenShot](screenshots/142.png)

Следующим шагом необходимо убедиться в наличии отчета о нарушении в Traffic Monitor. На рисунке ниже видно, что отчет о копировании с машины клиента на съемный носитель присутствует, также есть графическое изображение копируемого документа.

![ScreenShot](screenshots/143.png)

На рисунке ниже показано, что отчет о копировании со съемного носителя на машину клиента присутствует, также есть графическое изображение копируемого документа

![ScreenShot](screenshots/144.png)

Также следует проверить передачу паспортных данных в формате текстового документа:

![ScreenShot](screenshots/145.png)

Следующей политикой защиты данных на агентах было правило копирования данных кредитных карт на съемный носитель и со съемного носителя. Нарушив данную политику на машине клиента, появляется уведомление от Device Monitor

![ScreenShot](screenshots/146.png)

Далее нужно проверить копирование данных кредитной карты в Device Monitor

![ScreenShot](screenshots/147.png)

Следующим шагом необходимо убедиться в наличии отчета о нарушении в Traffic Monitor. На рисунке далее видно, что отчет о копировании с машины клиента на съемный носитель присутствует, также есть графическое изображение копируемой кредитной карты.

![ScreenShot](screenshots/148.png)

Также следует проверить передачу данных кредитной карты в формате текстового документа. На рисунке ниже показано, что политика сработала на текстовый документ, в котором были записаны номера кредитных карт.

![ScreenShot](screenshots/149.png)

---
